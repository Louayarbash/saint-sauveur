<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button *ngIf="ltr" icon="arrow-back"></ion-back-button>
      <ion-back-button *ngIf="!ltr" icon="arrow-forward"></ion-back-button>
    </ion-buttons>
    <ion-title slot="start">{{ dealDetails | translate }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="openFirebaseUpdateModal()" *ngIf="userIsCreator">
          {{ 'Edit' | translate }}
           <!-- - {{ loginID }} - {{item.id}} -->
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <ng-container *ngIf="item.isShell">
    <div class="DivLoading">
      <ion-spinner></ion-spinner>
<!--       <p>
        Fetching data...
      </p> -->
    </div>
  </ng-container>
  <ng-container *ngIf="!item.isShell">
<ion-card class="itemCard ion-padding-bottom">
  <ion-row color="main" class="expiration-countdown ion-align-items-center" *ngIf="typeIsRequest && ((startTimeCounter | appTimeDifference) >= 0) && (!item.isShell) && (item.status == 'new')">
    <ion-col size='6' class="ion-text-end">
    <span class="expiration-lead">{{ 'RequestExpiresIn' | translate }}</span>
  </ion-col>
  <ion-col size='6' class="ion-no-padding">
    <app-countdown-timer class="item-countdown" fill="countdown" [end]="startTimeCounter" [units]="{from: 'day', to: 'second'}"></app-countdown-timer>
  </ion-col> 
  </ion-row>
  <ion-row class="expiration-countdown ion-align-items-center" *ngIf="(!typeIsRequest) && ((startTimeCounter | appTimeDifference) >= 0) && (!item.isShell) && (item.status == 'new')">
    <ion-col size='6' class="ion-text-end">
    <span class="expiration-lead">{{ 'OfferExpiresIn' | translate }}</span>
  </ion-col>
  <ion-col size='6' class="ion-no-padding">
    <app-countdown-timer class="item-countdown" fill="countdown" [end]="startTimeCounter" [units]="{from: 'day', to: 'second'}"></app-countdown-timer>
  </ion-col> 
  </ion-row>
  <ion-row class="expiration-countdown ion-align-items-center" *ngIf="((startTimeCounter | appTimeDifference) >= 0) && (!item.isShell) && (item.status == 'accepted')">
  <ion-col size='6' class="ion-text-end">
    <span class="expiration-lead">{{ 'DealStartsIn' | translate }}</span>
  </ion-col>
  <ion-col size='6' class="ion-no-padding">
    <app-countdown-timer class="item-countdown" fill="countdown" [end]="startTimeCounter" [units]="{from: 'day', to: 'second'}"></app-countdown-timer>
  </ion-col> 
  </ion-row>
  <ion-row class="expiration-countdown ion-align-items-center" *ngIf="((endTimeCounter | appTimeDifference) >= 0 ) && (!item.isShell) && (item.status == 'started')">
  <ion-col size='6' class="ion-text-end">
    <span class="expiration-lead">{{ 'DealEndsIn' | translate }}</span>
  </ion-col>
  <ion-col size='6' class="ion-no-padding">
    <app-countdown-timer class="item-countdown" fill="countdown" [end]="endTimeCounter" [units]="{from: 'day', to: 'second'}"></app-countdown-timer>
  </ion-col> 
  </ion-row>
    <ion-item *ngIf="dateMsg">
      <ion-label>{{ 'Date' | translate }}</ion-label>
      <ion-text>{{ dateMsg }}</ion-text> 
    </ion-item>
    <ion-item *ngIf="startTimeMsg">
      <ion-label>{{ 'FromTime' | translate }}</ion-label>
      <ion-text>{{ startTimeMsg }}</ion-text> 
    </ion-item>
    <ion-item *ngIf="endTimeMsg" lines="none">
      <ion-label>{{ 'ToTime' | translate }}</ion-label>
      <ion-text>{{ endTimeMsg }}</ion-text> 
    </ion-item>
    <ion-item *ngIf="endTimeMsg" lines="none">
      <ion-label>{{ 'Status' | translate }}</ion-label>
      <ion-text>{{ item.status | translate }}</ion-text> 
    </ion-item>
  </ion-card>
<ion-card class="itemCard" *ngIf="userInfoCreatorBlock">
  <ion-card-header>
    <!-- <ion-card-subtitle>{{ 'creatorDetails' | translate}}</ion-card-subtitle> -->
    <ion-card-title>{{ creatorDetails | translate}}</ion-card-title>
  </ion-card-header>
  <ion-card-content>
    <!-- <div class="user-details"> -->
        <ion-row class="user-details-section">
          <ion-col class="user-image-wrapper">
             <app-aspect-ratio [ratio]="{w: 1, h: 1}">
              <app-image-shell class="user-image" animation="spinner" [src]="item.userInfoCreator?.photo"></app-image-shell>
            </app-aspect-ratio>
          </ion-col>
          <ion-col class="user-info-wrapper">
            <ion-row>
              <ion-col>
                <ion-row>
                  <ion-label>
                    {{ 'Name' | translate }}: {{ userNameCreator }}
                   </ion-label>
           <!--     <h4 class="user-name"> 
                  {{ 'Name' | translate }}: {{ userNameCreator }}
                </h4> -->
              </ion-row>
<!--                 <ion-row>
                <ion-label>{{ 'Building' | translate }}: {{ item.userInfoCreator?.building }}
                </ion-label>
              </ion-row> -->
                <ion-row>
                <ion-label>
                  {{ 'Email' | translate }}: {{ item.userInfoCreator?.email }}
                </ion-label>
              </ion-row>
              </ion-col>
            </ion-row>
            <ion-row *ngIf="!isRatedCreator">
              <ion-col>
                <ion-label>{{ 'Rating' | translate }}: {{ 'NotRatedYet' | translate }}</ion-label>
              </ion-col>
            </ion-row>
            <ion-row *ngIf="isRatedCreator">
              <ion-col>
                <ion-label>{{ 'Rating' | translate }}: {{ avgCreatorRating | async }} {{ 'Of' | translate }} 5</ion-label>
              </ion-col>
            </ion-row>
            <form [formGroup]="ratingFormCreator" *ngIf="isRatedCreator">
            <ion-row>
            <ion-col size="auto">
              <app-rating-input formControlName="rate" max="5" readOnly="true"></app-rating-input>
            </ion-col>
          </ion-row>
          </form>                    
          <ion-row *ngIf="!typeIsRequest && !userIsCreator && item.status == 'accepted'" class="ion-align-items-center ion-padding-bottom ion-border">
            <ion-col>
              <ion-chip>  
              <ion-label>{{ 'ParkingInfo' | translate }}: {{ parkingInfo }}
              </ion-label>
            </ion-chip>
            </ion-col>
            <ion-col>
              <ion-button class="ion-no-margin" size="small" color="main" (click)="share()">{{ 'Share' | translate }}<ion-icon name="share-social"></ion-icon></ion-button>
             </ion-col>
          </ion-row>
          <!-- </ion-chip> -->
           <!-- <ion-row *ngIf="chatWithCreatorButton"> -->
             <ion-row *ngIf="!userIsCreator && isRatedCreator">
<!--              <ion-col size="auto" class="ion-margin-bottom">
             <ion-button class="ion-padding-end ion-no-margin" size="small" color="medium" (click)="call(item.userInfoCreator.phone)">{{ 'Call' | translate }}<ion-icon name="call"></ion-icon></ion-button>
            </ion-col> 
                         <ion-col size="auto" class="ion-margin-bottom">
             <ion-button class="ion-padding-end ion-no-margin" size="small" color="main" (click)="openChatModal()">{{ 'Chat' | translate }}<ion-icon name="chatbubbles"></ion-icon></ion-button>
            </ion-col>  -->
            <ion-col size="auto">
             <ion-button class="ion-no-margin" size="small" color="main" (click)="openReviewModal('creator')">{{ 'Review' | translate }}<ion-icon name="star-half"></ion-icon></ion-button>				
            </ion-col>
          </ion-row>
          </ion-col>
        </ion-row>
      </ion-card-content>
      <!-- </div> -->
    </ion-card>
    <ion-card class="itemCard" *ngIf="userInfoResponderBlock">
      <ion-card-header>
        <!-- <ion-card-subtitle>{{ 'creatorDetails' | translate}}</ion-card-subtitle> -->
        <ion-card-title>{{ responderDetails | translate}}</ion-card-title>
      </ion-card-header>
      <ion-card-content>
      <ion-row class="user-details-section">
        <ion-col class="user-image-wrapper">
           <app-aspect-ratio [ratio]="{w: 1, h: 1}">
            <app-image-shell class="user-image" animation="spinner" [src]="item.userInfoResponder?.photo"></app-image-shell>
          </app-aspect-ratio>
        </ion-col>
        <ion-col class="user-info-wrapper">
          <ion-row>
            <ion-col>	
              <ion-row>		
                <ion-label>
                  {{ 'Name' | translate }}: {{ userNameResponder }}
                </ion-label>	 
<!--               <h4 class="user-name">
                
              </h4> -->
               </ion-row>
<!--               <ion-row>
              <ion-label>{{ 'Building' | translate }}: {{ item.userInfoResponder?.building }} 
              </ion-label>
            </ion-row> -->
            <ion-row>
              <ion-label>
                {{ 'Email' | translate }}: {{ item.userInfoResponder?.email }}
              </ion-label>
            </ion-row>
            </ion-col>
          </ion-row>
          <ion-row *ngIf="!isRatedResponder">
            <ion-col>
              <ion-label>{{ 'Rating' | translate }}: {{ 'NotRatedYet' | translate }}</ion-label>
            </ion-col>
          </ion-row>
          <ion-row *ngIf="isRatedResponder">
            <ion-col>
              <ion-label>{{ 'Rating' | translate }}: {{ avgResponderRating | async }} {{ 'Of' | translate }} 5</ion-label>
            </ion-col>
          </ion-row>
          <form [formGroup]="ratingFormResponder" *ngIf="isRatedResponder">
          <ion-row>
          <ion-col size="auto">
            <app-rating-input formControlName="rate" max="5" readOnly="true"></app-rating-input>
          </ion-col>
        </ion-row>
        </form>
        <ion-row *ngIf="userIsCreator && isRatedResponder">
          <!--             <ion-col size="auto" class="ion-margin-bottom">
                       <ion-button class="ion-padding-end ion-no-margin" size="small" color="medium" (click)="call(item.userInfoResponder.phone)">{{ 'Call' | translate }}<ion-icon name="call"></ion-icon></ion-button>
                      </ion-col> -->
          <!--             <ion-col size="auto" class="ion-margin-bottom">
                       <ion-button class="ion-padding-end ion-no-margin" size="small" color="main" (click)="openChatModal()">{{ 'Chat' | translate }}<ion-icon name="chatbubbles"></ion-icon></ion-button>
                      </ion-col> -->
                       <ion-col size="auto" >
                       <ion-button class="ion-no-margin" size="small" color="main" (click)="openReviewModal('responder')">{{ 'Review' | translate }}<ion-icon name="star-half"></ion-icon></ion-button>				
                      </ion-col>
                    </ion-row>
<!--         <ion-row *ngIf="typeIsRequest" >
          <ion-col class="main-actions ion-align-items-center">
            <ion-label>{{ 'ParkingInfo' | translate }}: </ion-label>
            <ion-button class="ion-no-margin" size="small" color="medium" (click)="share()">{{parkingInfo}}<ion-icon name="share-social"></ion-icon></ion-button>
             <ion-label>{{ 'ParkingInfo' | translate }}: {{ parkingInfo }}
            </ion-label> 
          </ion-col>
           <ion-col class="main-actions">
            <ion-button class="ion-no-margin" size="small" color="medium" (click)="share()">{{ 'Share' | translate }}<ion-icon name="share-social"></ion-icon></ion-button>
           </ion-col> 
        </ion-row> -->
        <ion-row *ngIf="typeIsRequest && userIsCreator && item.status == 'accepted'" class="ion-align-items-center ion-padding-bottom ion-border">
          <ion-col>
            
            <ion-label>{{ 'ParkingInfo' | translate }}: {{ parkingInfo }}
            </ion-label>
            <ion-button class="ion-no-margin" size="small" color="main" (click)="share()">{{ 'Share' | translate }}<ion-icon name="share-social"></ion-icon></ion-button>
          </ion-col>
<!--           <ion-col>
            <ion-button class="ion-no-margin" size="small" color="main" (click)="share()">{{ 'ParkingInfo' | translate }}: {{ parkingInfo }}<ion-icon name="share-social"></ion-icon></ion-button>
           </ion-col> -->
         
        </ion-row>

        </ion-col>
      </ion-row>
      </ion-card-content>
    </ion-card>
      <ion-card class="itemCard" *ngIf="noteSection">
          <ion-item lines="none">
            <ion-label>{{ 'Note' | translate }}</ion-label>
          </ion-item>
          <ion-item>
          <ion-textarea rows="6" [value]="item.note" readonly class="ion-no-padding"></ion-textarea>
          </ion-item>
      </ion-card>
<!--   <ion-row class="expiration-countdown" *ngIf="((endTimeCounter | appTimeDifference) < 0 ) && (!item.isShell) && (item.status == 'ended')">
    <span class="expiration-lead"> 
      {{ item.status | translate }}
    </span>
</ion-row> -->

</ng-container>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="chatButton">
    <ion-fab-button color="main" (click)="openChatModal()">
      <ion-icon name="chatbubbles-outline" ></ion-icon>
    </ion-fab-button>
  </ion-fab> 

<!-- <div *ngIf="chatWithCreatorButton"> -->

</ion-content>
<ion-footer *ngIf="!acceptButtonHidden || !cancelOfferDealButtonHidden || !cancelOfferButtonHidden || !proposeButtonHidden || !cancelRequestDealButtonHidden || !cancelRequestButtonHidden">
  <ion-row>
    <ion-col>
      <ion-button expand="block" color="main" (click)="acceptOffer()" [hidden]="acceptButtonHidden">{{ 'AcceptOffer' | translate }}</ion-button>
      <ion-button expand="block" color="primary" (click)="cancelOfferDeal()" [hidden]="cancelOfferDealButtonHidden">{{ 'CancelOfferDeal' | translate }}</ion-button>
      <ion-button expand="block" color="primary" (click)="cancelOffer()" [hidden]="cancelOfferButtonHidden">{{ 'CancelOffer' | translate }}</ion-button>

      <ion-button expand="block" color="main" (click)="proposeParking()" [hidden]="proposeButtonHidden">{{ 'ProposeMyParking' | translate }}</ion-button>
      <ion-button expand="block" color="primary" (click)="cancelRequestDeal()" [hidden]="cancelRequestDealButtonHidden">{{ 'CancelRequestDeal' | translate }}</ion-button>
      <ion-button expand="block" color="primary" (click)="cancelRequest()" [hidden]="cancelRequestButtonHidden">{{ 'CancelRequest' | translate }}</ion-button>
    </ion-col>
  </ion-row>
</ion-footer>