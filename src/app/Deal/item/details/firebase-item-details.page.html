<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="deal/listing"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'RequestDetails' | translate }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="openFirebaseUpdateModal()" *ngIf="loginID == item.createdBy" >
          {{ 'Edit' | translate }}
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content class="page-content">
<!--{{ startTimeCounter }}<br>
  {{ endTimeCounter }}<br>
  {{ startTimeCounter | appTimeDifference }}<br>
  {{ startTimeCounter | appTimeAgo}} -->
 <ion-row class="expiration-countdown" *ngIf="((startTimeCounter | appTimeDifference) >= 0) && (!item.isShell) && (item.status == 'new')">
  <span class="expiration-lead">{{ 'RequestExpiresIn' | translate }}</span>
  <app-countdown-timer class="item-countdown" fill="countdown" [end]="startTimeCounter" [units]="{from: 'day', to: 'second'}"></app-countdown-timer>
</ion-row>
<ion-row class="expiration-countdown" *ngIf="((startTimeCounter | appTimeDifference) >= 0) && (!item.isShell) && (item.status == 'accepted')">
    <span class="expiration-lead">{{ 'DealStartsIn' | translate }}</span>
    <app-countdown-timer class="item-countdown" fill="countdown" [end]="startTimeCounter" [units]="{from: 'day', to: 'second'}"></app-countdown-timer>
  </ion-row>
  <ion-row class="expiration-countdown" *ngIf="((endTimeCounter | appTimeDifference) >= 0 ) && (!item.isShell) && (item.status == 'started')">
    <span class="expiration-lead">{{ 'DealEndsIn' | translate }}</span>
    <app-countdown-timer class="item-countdown" fill="countdown" [end]="endTimeCounter" [units]="{from: 'day', to: 'second'}"></app-countdown-timer>
  </ion-row>
<!--   <ion-item class="input-item">
    <ion-label>{{ rating }}</ion-label>
  </ion-item> -->
  <!-- requestar rating {{ avgCreatorRating | async }} -->
  <!-- responder rating {{ avgRespoderRating | async }} -->
<!--   <div *ngFor= "let rating of creatorRating | async">
    {{ rating.userId }} gave {{ rating.dealId }} and {{ rating.ratedUserId }} : {{ rating.stars }} stars
  </div> -->
<!--   <div *ngFor= "let rating of respoderRating | async">
    {{ rating.userId }} gave {{ rating.dealId }} and {{ rating.ratedUserId }} : {{ rating.stars }} stars
  </div> -->
<!--   <ion-row >
    <ion-col >
      <ion-button class="ion-padding-end ion-no-margin" size="small" color="medium" (click)="rateUser()">Rate</ion-button>
    </ion-col>
    <ion-col >
      <ion-button class="ion-padding-end ion-no-margin" size="small" color="medium" (click)="openReviewModal()">Review</ion-button>
    </ion-col>
  </ion-row> -->
    <section>
        <ion-list class="inputs-list" lines="full">
          <ion-item class="input-item">
            <ion-label>Date</ion-label>
            <!-- <ion-input class="ion-text-end" type="text" readonly [value]="dateMsg"></ion-input> -->
            <app-text-shell [data]="dateMsg"></app-text-shell>
          </ion-item>
          <ion-item class="input-item">
            <ion-label>{{ 'FromTime' | translate }}</ion-label>
            <!-- <ion-input class="ion-text-end" type="text" readonly [value]="startTimeMsg"></ion-input> -->
            <app-text-shell [data]="startTimeMsg"></app-text-shell>
          </ion-item>
          <ion-item class="input-item">
            <ion-label >{{ 'ToTime' | translate }}</ion-label>
            <app-text-shell [data]="endTimeMsg"></app-text-shell>
            <!-- <ion-input class="ion-text-end" type="text" readonly [value]="endTimeMsg"></ion-input> -->
          </ion-item>
          <ion-item class="input-item">
            <ion-label>{{ 'NoPlace' | translate }}</ion-label>
            <ion-input class="ion-text-end" type="text" readonly [value]="1"></ion-input>
          </ion-item>
        </ion-list>
      </section>
      <ion-list class="inputs-list" lines="full" *ngIf="userInfoRequBlock">
        <ion-item class="input-item" lines="none">
      <ion-label>{{ 'RequesterDetails' | translate }}</ion-label>
    </ion-item>
    </ion-list>
      <div class="user-details" *ngIf="userInfoRequBlock">
        <ion-row class="user-details-section ion-align-items-end">
          <ion-col class="user-image-wrapper">
             <app-aspect-ratio [ratio]="{w: 1, h: 1}">
              <app-image-shell class="user-image" animation="spinner" [src]="item.userInfoRequ?.photo"></app-image-shell>
            </app-aspect-ratio>
          </ion-col>
          <ion-col class="user-info-wrapper">
            <ion-row>
              <ion-col>
                <ion-row>
                <h4 class="user-name">
                  {{ userNameRequ }}
                </h4>
              </ion-row>
                <ion-row>
                <ion-label>{{ 'Building' | translate }}: {{ item.userInfoRequ?.building }}
                </ion-label>
              </ion-row>
                <ion-row>
                <ion-label>
                  {{ 'Phone' | translate }}: {{ item.userInfoRequ?.phone }}
                </ion-label>
              </ion-row>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col>
                <ion-label>{{ 'Rating' | translate }}: {{ avgCreatorRating | async }} {{ 'Of' | translate }} 5</ion-label>
              </ion-col>
            </ion-row>
            <form [formGroup]="ratingFormCrea">
            <ion-row>
            <ion-col size="auto">
              <app-rating-input formControlName="rate" max="5" readOnly="true"></app-rating-input>
            </ion-col>
          </ion-row>
          </form>
            <ion-row class="actions-row" *ngIf="chatWithRequesterButton">
              <ion-col class="main-actions">
                <ion-button class="ion-padding-end ion-no-margin" size="small" color="medium" (click)="call(item.userInfoRequ.phone)">{{ 'Call' | translate }}<ion-icon name="call"></ion-icon></ion-button>
                <ion-button class="ion-padding-end ion-no-margin" size="small" color="medium" (click)="openChatModal()">{{ 'Chat' | translate }}<ion-icon name="chatbubbles"></ion-icon></ion-button>
                <ion-button *ngIf="ratingRequButton" class="ion-no-margin" size="small" color="medium" (click)="openReviewModal()">{{ 'Review' | translate }}<ion-icon name="star-half"></ion-icon></ion-button>
              </ion-col>
            </ion-row>
          </ion-col>
        </ion-row>
      </div>
      <ion-list class="inputs-list" lines="full" *ngIf="userInfoRespBlock">
        <ion-item class="input-item" lines="none">
        <ion-label>{{ 'ResponderDetails' | translate }}</ion-label>
      </ion-item>
    </ion-list>
    <div class="user-details" *ngIf="userInfoRespBlock">
      <ion-row class="user-details-section ion-align-items-end">
        <ion-col class="user-image-wrapper">
           <app-aspect-ratio [ratio]="{w: 1, h: 1}">
            <app-image-shell class="user-image" animation="spinner" [src]="item.userInfoResp?.photo"></app-image-shell>
          </app-aspect-ratio>
        </ion-col>
        <ion-col class="user-info-wrapper">
          <ion-row>
            <ion-col>	
              <ion-row>			 
              <h4 class="user-name">
                {{ userNameResp }}
              </h4>
               </ion-row>
              <ion-row>
              <ion-label>{{ 'Building' | translate }}: {{ item.userInfoResp?.building }}
              </ion-label>
            </ion-row>
              <ion-row>
              <ion-label>
                {{ 'Phone' | translate }}: {{ item.userInfoResp?.phone }}
              </ion-label>
            </ion-row>
            </ion-col>

          </ion-row>
          <ion-row>
            <ion-col>
              <ion-label>{{ 'Rating' | translate }}: {{ avgRespoderRating | async }} {{ 'Of' | translate }} 5 </ion-label>
            </ion-col>
          </ion-row>
          <form [formGroup]="ratingFormResp">
          <ion-row>
          <ion-col size="auto">
            <app-rating-input formControlName="rate" max="5" readOnly="true"></app-rating-input>
          </ion-col>
        </ion-row>
        </form>
           <ion-row class="actions-row">
            <ion-col class="main-actions">
             <ion-button class="ion-padding-end ion-no-margin" size="small" color="medium" (click)="call(item.userInfoResp.phone)">{{ 'Call' | translate }}<ion-icon name="call"></ion-icon></ion-button>
              <ion-button class="ion-padding-end ion-no-margin" size="small" color="medium" (click)="openChatModal()">{{ 'Chat' | translate }}<ion-icon name="chatbubbles"></ion-icon></ion-button>
              <ion-button *ngIf="ratingRespButton" class="ion-no-margin" size="small" color="medium" (click)="openReviewModal()">{{ 'Review' | translate }}<ion-icon name="star-half"></ion-icon></ion-button>				
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
    </div>
      <section *ngIf="noteSection">
          <ion-item class="input-item" lines="none">
            <ion-label>Note</ion-label>
          </ion-item>
          <ion-item class="input-item">
          <ion-textarea rows="6" [value]="item.note" readonly class="ion-no-padding"></ion-textarea>
          </ion-item>
      </section>
  <ion-row class="expiration-countdown" *ngIf="((endTimeCounter | appTimeDifference) < 0 ) && (!item.isShell) && (item.status == 'ended')">
    <span class="expiration-cta"> 
      {{ item.status | translate }}
    </span>
<!--     <span class="item-time-left">
      <app-text-shell [data]="(endTimeCounter | appTimeAgo)"></app-text-shell>
    </span> -->
</ion-row>
</ion-content>
<ion-footer>
  <ion-row>
    <ion-col>
      <ion-button class="delete-btn" expand="block" color="primary" fill="outline" (click)="proposeParking()" [hidden]="proposeButtonHidden">{{ 'ProposeMyParking' | translate }}</ion-button>
      <ion-button class="delete-btn" expand="block" color="primary" fill="outline" (click)="cancelDeal()" [hidden]="cancelDealButtonHidden">{{ 'CancelDeal' | translate }}</ion-button>
      <ion-button class="delete-btn" expand="block" color="primary" fill="outline" (click)="cancelRequest()" [hidden]="cancelRequestButtonHidden">{{ 'CancelRequest' | translate }}</ion-button>
    </ion-col>
  </ion-row>
</ion-footer>
